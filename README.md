# Windows Virtual Desktop

## 目的
- Windows Virtual Desktop (WVD) を構築し、アーキテクチャを把握する。

## 前提
- Azure サブスクリプションを保有していること。

## 2 種類のデスクトップ仮想化方式
以下のように、「仮想デスクトップ」には 2 つの形態が存在する。

![alt text](./images/wvd-architecture.png)

### A. VDI 方式
仮想サーバ上に作成された仮想デスクトップを 1 ユーザごとに 1 台ずつ割り当てる方式。<br>

#### メリット
 - 物理 PC とほぼ同等の自由度の高いパフォーマンスを発揮する。
 - 特定のユーザの処理が他のユーザに影響しない。

#### デメリット
 - 1 人 1 台なので、コストが高い。

### B. SBC 方式
サーバ OS 上のアプリなどを複数のユーザで共有して使用する方式。

#### メリット
 - コストを抑えることができる。
 - 端末ごとのバージョン管理が不要。

#### デメリット
 - サーバ OS をクライアントとして使用するため、そもそもの用途が異なり、自由度が下がる。

## WVD 全体像
アーキテクチャは下図の通り。

![alt text](./images/wvd-azure-architecture.png)

WVD には、下図のような概念がある。

![alt text](./images/wvd-internal-architecture.png)

### ホストプール : Host pools
ホストプールは、セッションホスト（VM）の集合を指す。<br>
ホストプールには、以下の 2 形態が存在する。

| タイプ | 概要 |
| :---: | :--- |
| Personal | 各セッションホストに対してユーザを 1 対 1 で紐づける。<br>自動割り当てオプションの選択が可能。 |
| Pooled | 1 つのセッションホストを複数のユーザで利用する。 |

Pooled にすると、 1 つの VM に対する最大同時ユーザ数を設定する必要がある。最大同時ユーザ数を設定後、ホストプールの負荷分散方法を選択する。

負荷分散方法は下記の通り設定が可能。

| モード | 概要 |
| :--- | :--- |
| 軸優先モード | ユーザが全ての VM に均等にログオンする。つまり、 1 人目のユーザは VM 1 にログオンし、 2 人目のユーザは VM 2 にログオンする、といった具合で負荷分散する。 |
| 深さ優先モード | 設定した最大同時ユーザ数が VM 1 にログオンするまで、他の VM にはログオンしない。 |

### アプリケーショングループ：Application Groups
ホストプール内のデスクトップやアプリケーションを論理的にまとめた集合を指す。

### Windows 10 マルチセッション
1 台の VM に対し、複数のユーザが接続可能な VDI 方式の環境を構築可能。 VDI 方式と SBD 方式のいいとこ取りをするイメージ（ SBC のようにコストを節約しつつ、 VDI のように高い自由度も実現可能）。

